CREATE TABLE IF NOT EXISTS %dbprefix%navigation_menu ( id int(11) NOT NULL AUTO_INCREMENT, menu_name varchar(250) UNIQUE, parent_name varchar(250) NOT NULL,menu_order int(11) NOT NULL,menu_url varchar(500), menu_icon varchar(100), menu_text varchar(200),required_module VARCHAR(25) NULL, PRIMARY KEY (id), is_deleted INT NULL, sync_status INT NULL );
CREATE TABLE IF NOT EXISTS %dbprefix%menu_access ( id int(11) NOT NULL AUTO_INCREMENT, menu_name varchar(50) NOT NULL, category_name varchar(50) NOT NULL, allow tinyint(1), PRIMARY KEY (id), UNIQUE( menu_name, category_name) );
CREATE TABLE IF NOT EXISTS %dbprefix%doctor (  doctor_id int(11) NOT NULL AUTO_INCREMENT, dob DATE NULL ,description VARCHAR( 250 ) NULL , contact_id int(11) NOT NULL, degree varchar(150) NULL, specification varchar(300) NULL,experience varchar(300) NULL, joining_date date NULL, licence_number varchar(50) NULL,  department_id int(11) NULL,  gender varchar(10) NULL,userid VARCHAR(16) NULL ,sync_status INT NULL,is_deleted INT(1) NULL,erpnext_key VARCHAR(25) NULL, PRIMARY KEY (doctor_id));
CREATE TABLE IF NOT EXISTS %dbprefix%data (ck_data_id int(11) NOT NULL AUTO_INCREMENT,ck_key varchar(50) NOT NULL DEFAULT '',ck_value varchar(500) NOT NULL DEFAULT '',PRIMARY KEY (ck_data_id), is_deleted INT NULL, sync_status INT NULL);
CREATE TABLE IF NOT EXISTS %dbprefix%appointments ( appointment_id int(11) NOT NULL AUTO_INCREMENT,appointment_date date NOT NULL,end_date date NULL DEFAULT NULL,start_time time NOT NULL,end_time time NOT NULL,title varchar(150) NOT NULL,patient_id int(11) NOT NULL,userid int(11) NOT NULL,doctor_id int(11) NOT NULL,status varchar(255) NOT NULL, visit_id int(11) NOT NULL DEFAULT 0,appointment_reason VARCHAR(100),PRIMARY KEY (appointment_id),clinic_id INT( 11 ) NULL, is_deleted INT NULL, sync_status INT NULL);
CREATE TABLE IF NOT EXISTS %dbprefix%appointment_log (appointment_log_id INT NOT NULL AUTO_INCREMENT, appointment_id int(11) NOT NULL,change_date_time varchar(255) NOT NULL,start_time time NOT NULL,from_time time NOT NULL,to_time time NOT NULL,old_status varchar(255) NOT NULL,status varchar(255) NOT NULL,name varchar(255) NOT NULL,appointment_reason VARCHAR(100),PRIMARY KEY ( appointment_log_id ), is_deleted INT NULL, sync_status INT NULL);
CREATE TABLE IF NOT EXISTS %dbprefix%bill_payment_r (bill_payment_id INT(11) NOT NULL AUTO_INCREMENT , bill_id INT(11) NOT NULL , payment_id INT(11) NOT NULL , adjust_amount DECIMAL(11) NULL, PRIMARY KEY (bill_payment_id), is_deleted INT NULL,sync_status INT NULL);
CREATE TABLE IF NOT EXISTS %dbprefix%bill (bill_id int(11) NOT NULL AUTO_INCREMENT, clinic_id  int(11) NULL, doctor_id  int(11) NULL,bill_date date NOT NULL,bill_time TIME NULL, patient_id int(11) NOT NULL,visit_id int(11) NOT NULL,total_amount DECIMAL(10,0) NOT NULL DEFAULT '0',tax_amount DECIMAL(10,2) NULL DEFAULT '0',due_amount DECIMAL(11,2) NOT NULL DEFAULT '0',PRIMARY KEY (bill_id), is_deleted INT NULL, sync_status INT NULL,clinic_code VARCHAR(6) NULL);
CREATE TABLE IF NOT EXISTS %dbprefix%bill_detail (bill_detail_id int(11) NOT NULL AUTO_INCREMENT, clinic_code VARCHAR(6) NULL ,item_id INT NULL , bill_id int(11) NOT NULL , particular VARCHAR(50) NULL, amount DECIMAL(10,2) NULL, quantity INT(11) NULL, mrp DECIMAL(10,2) NULL, type varchar(25) NOT NULL, purchase_id int(11), tax_amount DECIMAL(10,2) NULL ,PRIMARY KEY (bill_detail_id), is_deleted INT NULL, sync_status INT NULL);
CREATE TABLE IF NOT EXISTS %dbprefix%clinic ( clinic_id int(11) NOT NULL AUTO_INCREMENT, start_time varchar(10) NOT NULL, end_time varchar(10) NOT NULL, time_interval decimal(11,2) NOT NULL DEFAULT '0.50', clinic_name varchar(50), clinic_code VARCHAR(6) NULL, tag_line VARCHAR(100), clinic_address VARCHAR(500), landline VARCHAR(50), mobile VARCHAR(50), email VARCHAR(50), facebook VARCHAR(50), twitter VARCHAR(50), google_plus VARCHAR(50), next_followup_days INT(11) NULL DEFAULT '15',clinic_logo VARCHAR(255) NULL , website VARCHAR(50) NULL,max_patient INT( 11 ) NULL, is_deleted INT NULL, sync_status INT NULL,PRIMARY KEY(clinic_id));
CREATE TABLE IF NOT EXISTS %dbprefix%contacts ( contact_id int(11) NOT NULL AUTO_INCREMENT, title VARCHAR( 5 ) NULL, first_name varchar(50) DEFAULT NULL, middle_name varchar(50) DEFAULT NULL, last_name varchar(50) NOT NULL, display_name varchar(255) NULL, phone_number varchar(15) NULL, second_number VARCHAR( 25 ) NULL, email varchar(150) NULL, contact_image varchar(255) NOT NULL DEFAULT 'images/Profile.png', type VARCHAR( 50 ) NULL, address_line_1 varchar(150) NULL, address_line_2 varchar(150) NULL, city varchar(50) NULL, state varchar(50) NULL, postal_code varchar(50) NULL, country varchar(50) NULL, PRIMARY KEY (contact_id),is_deleted INT NULL, sync_status INT NULL );
CREATE TABLE IF NOT EXISTS %dbprefix%contact_details ( contact_detail_id int(11) NOT NULL AUTO_INCREMENT, clinic_code VARCHAR(6) NULL ,contact_id int(11) NOT NULL, type varchar(50) NOT NULL, detail varchar(150) NOT NULL, is_default INT(1) NULL, PRIMARY KEY (contact_detail_id), is_deleted INT NULL, sync_status INT NULL );
CREATE TABLE IF NOT EXISTS %dbprefix%followup ( id INT(11) NOT NULL AUTO_INCREMENT,doctor_id int(11) NOT NULL,patient_id int(11) NOT NULL,followup_date date NOT NULL,PRIMARY KEY (id), is_deleted INT NULL, sync_status INT NULL);
CREATE TABLE IF NOT EXISTS %dbprefix%invoice ( invoice_id INT(11) NOT NULL AUTO_INCREMENT , static_prefix VARCHAR(10) NOT NULL DEFAULT '', left_pad INT(11) NOT NULL , next_id INT(11) NOT NULL , currency_symbol VARCHAR(10) NULL, currency_postfix CHAR(10) NULL DEFAULT '/-', PRIMARY KEY ( invoice_id ), is_deleted INT NULL, sync_status INT NULL );
CREATE TABLE IF NOT EXISTS %dbprefix%modules ( module_id int(11) NOT NULL AUTO_INCREMENT, module_name varchar(50) UNIQUE NOT NULL, module_display_name varchar(50) NOT NULL, module_description varchar(150) NOT NULL, module_status int(1) NOT NULL, PRIMARY KEY (module_id),module_version VARCHAR(10) NULL, activation_hook VARCHAR(50) NULL , license_key VARCHAR(100) NULL, license_status VARCHAR(100) NULL,required_modules VARCHAR(250) NULL, is_deleted INT NULL, sync_status INT NULL );
CREATE TABLE IF NOT EXISTS %dbprefix%patient ( patient_id int(11) NOT NULL AUTO_INCREMENT,blood_group VARCHAR(3) NULL, reference_by_detail VARCHAR(50) NULL,contact_id int(11) NOT NULL, patient_since date NOT NULL, display_id varchar(12) NULL, ssn_id VARCHAR(25) NULL, followup_date date NULL, reference_by varchar(255) NULL, gender VARCHAR(10) , dob DATE , age INT(11) NULL, wp_user_id INT(11) NULL, clinic_id INT(11) NULL ,is_deleted INT NULL, sync_status INT NULL , clinic_code VARCHAR(6) NULL, is_inquiry INT(1) NULL,inquiry_reason VARCHAR(50) NULL,erpnext_key VARCHAR(25) NULL, PRIMARY KEY (patient_id));
CREATE TABLE IF NOT EXISTS %dbprefix%payment ( payment_id int(11) NOT NULL AUTO_INCREMENT, patient_id int(11) NOT NULL, pay_date date NOT NULL, pay_mode varchar(50) NOT NULL, pay_amount DECIMAL(10,0) NOT NULL DEFAULT '0', additional_detail VARCHAR(50) NULL, level VARCHAR(25) NOT NULL, clinic_id INT(11) NULL ,is_deleted INT NULL, sync_status INT NULL , payment_status varchar(25) NOT NULL DEFAULT 'complete', PRIMARY KEY (payment_id));
CREATE TABLE IF NOT EXISTS %dbprefix%payment_transaction ( transaction_id  int(11) NOT NULL AUTO_INCREMENT,bill_id int(11),patient_id int(11) NOT NULL,visit_id int(11) NOT NULL, amount decimal(11,2) NOT NULL,payment_type varchar(50) NOT NULL,PRIMARY KEY (transaction_id), sync_status INT NULL);
CREATE TABLE IF NOT EXISTS %dbprefix%reference_by (reference_id int(11) NOT NULL AUTO_INCREMENT, reference_option varchar(25) NOT NULL, reference_add_option int(1) DEFAULT NULL, placeholder VARCHAR( 25 ) NULL , PRIMARY KEY (reference_id),is_deleted INT NULL, sync_status INT NULL);
CREATE TABLE IF NOT EXISTS %dbprefix%receipt_template (template_id int(11) NOT NULL AUTO_INCREMENT,template text NOT NULL,is_default int(1) NOT NULL,template_name varchar(25) NOT NULL,`type` VARCHAR(15) NULL,PRIMARY KEY (template_id), is_deleted INT NULL, sync_status INT NULL);
CREATE TABLE IF NOT EXISTS %dbprefix%todos ( id_num int(11) NOT NULL AUTO_INCREMENT, userid int(11) DEFAULT '0', todo varchar(250) DEFAULT NULL, done int(11) DEFAULT '0', add_date datetime DEFAULT NULL, done_date datetime DEFAULT NULL, PRIMARY KEY (id_num), is_deleted INT NULL, sync_status INT NULL);
CREATE TABLE IF NOT EXISTS %dbprefix%user_verification ( verification_id int(11) NOT NULL AUTO_INCREMENT, user_email varchar(50) NOT NULL, verification_code int(6) NOT NULL, code_generated_at timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, code_is_verified int(1) DEFAULT NULL,  PRIMARY KEY (verification_id));
CREATE TABLE IF NOT EXISTS %dbprefix%users ( userid int(11) NOT NULL AUTO_INCREMENT, name varchar(255) DEFAULT NULL, username varchar(25) DEFAULT NULL, password varchar(255) NOT NULL, level varchar(25) NOT NULL,is_active INT(1) NOT NULL DEFAULT '1', PRIMARY KEY (userid), UNIQUE KEY username (username),contact_id INT( 11 ) NULL, centers VARCHAR( 50 ) NULL, is_deleted INT NULL, sync_status INT NULL );
CREATE TABLE IF NOT EXISTS %dbprefix%user_categories ( id int(11) NOT NULL AUTO_INCREMENT, category_name VARCHAR(50) NULL DEFAULT NULL, PRIMARY KEY (id), is_deleted INT NULL, sync_status INT NULL );
CREATE TABLE IF NOT EXISTS %dbprefix%visit ( visit_id int(11) NOT NULL AUTO_INCREMENT, patient_id int(11) NOT NULL, userid int(11) NOT NULL, doctor_id int(11) NOT NULL, notes TEXT NULL, type varchar(50) NOT NULL, visit_date varchar(60) NOT NULL, clinic_id INT(1) NULL, visit_time varchar(50), patient_notes TEXT NULL,appointment_reason VARCHAR(100), PRIMARY KEY (visit_id), is_deleted INT NULL, sync_status INT NULL );
CREATE TABLE IF NOT EXISTS %dbprefix%patient_account (  patient_account_id int(11) NOT NULL AUTO_INCREMENT,  patient_id int(11) NOT NULL,  payment_id int(11) DEFAULT NULL,  bill_id int(11) DEFAULT NULL,  adjust_amount decimal(11,2) NOT NULL,PRIMARY KEY (patient_account_id));
CREATE TABLE IF NOT EXISTS %dbprefix%version (id INT NOT NULL AUTO_INCREMENT,current_version varchar(11) NOT NULL, is_deleted INT NULL, sync_status INT NULL ,  PRIMARY KEY (id)); 
CREATE TABLE IF NOT EXISTS %dbprefix%working_days (uid int(11) NOT NULL AUTO_INCREMENT,working_date date NOT NULL,working_status varchar(15) NOT NULL, working_reason varchar(50) NULL, PRIMARY KEY (uid), is_deleted INT NULL, sync_status INT NULL);
CREATE TABLE IF NOT EXISTS %dbprefix%payment_methods ( payment_method_id INT(11) NOT NULL AUTO_INCREMENT , payment_method_name VARCHAR(25) NOT NULL , has_additional_details INT(1) NOT NULL , additional_detail_label VARCHAR(50) NOT NULL , needs_cash_calc INT(1) NOT NULL DEFAULT '0',PRIMARY KEY (payment_method_id));
CREATE TABLE IF NOT EXISTS %dbprefix%language_data ( id INT(11) NOT NULL AUTO_INCREMENT , l_name VARCHAR(25) NOT NULL , l_index VARCHAR(150) NOT NULL , l_value VARCHAR(250) NOT NULL , PRIMARY KEY (id));
INSERT INTO %dbprefix%navigation_menu (menu_name, parent_name, menu_order, menu_url, menu_icon, menu_text, required_module, sync_status, is_deleted) VALUES ('cash_receipt', 'account', '500', 'account/cash_receipt', NULL, 'Cash Receipt', NULL, NULL, NULL);
INSERT INTO %dbprefix%navigation_menu (menu_name, parent_name, menu_order, menu_url, menu_icon, menu_text, required_module, sync_status, is_deleted) VALUES ('bank_payment', 'account', '200', 'account/bank_payment', NULL, 'Bank Payment', NULL, NULL, NULL);
INSERT INTO %dbprefix%navigation_menu (menu_name, parent_name, menu_order, menu_url, menu_icon, menu_text, required_module) VALUES ('general_settings', 'frontend', '400', 'frontend/general_settings', NULL, 'General Settings', 'frontend');
INSERT INTO %dbprefix%navigation_menu (menu_name, parent_name, menu_order, menu_url, menu_icon, menu_text, required_module) VALUES ('reference_by', 'administration', '750', 'settings/reference_by', NULL, 'Reference By', NULL);
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('backup', 'administration', '600', 'settings/backup', NULL, 'Backup', NULL);
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('new_patient', 'patients', '100', 'patient/insert', NULL, 'Add Patient', NULL);
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('working_days','administration',200, 'settings/working_days',NULL, 'Working Days',NULL);
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('all_users', 'users', '100', 'admin/users', NULL, 'All Users', NULL);
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('patients','',200, '#', 'fa-users', 'Patients','');
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('all_patients', 'patients', '0', 'patient/index', NULL, 'All Patients', NULL);
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('new_inquiry', 'patients', '200', 'patient/new_inquiry_report', NULL, 'New Inquiries', NULL);
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('appointments','', 100,'appointment/index', 'fa-calendar', 'Appointments','');
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('reports', '', 400,'#', 'fa-line-chart', 'Reports','');
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('administration', '', 500,'#', 'fa-cog', 'Administration','');
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('modules', '', 600,'module/index', 'fa-shopping-cart', 'Modules','');
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('appointment report', 'reports',100, 'appointment/appointment_report', '', 'appointment_report','');
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('bill report', 'reports', 300,'patient/bill_detail_report', '', 'bill_report','');
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('clinic detail', 'administration', 100,'settings/clinic', '', 'Clinic Detail','');
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('users', 'administration', 300,'#', '', 'Users','');
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('setting', 'administration', 500,'settings/change_settings', '', 'Setting','');
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('payment', '', 300,'payment/index', 'fa-money', 'Payments','');
INSERT INTO %dbprefix%navigation_menu (menu_name,parent_name,menu_order,menu_url,menu_icon,menu_text,required_module) VALUES ('pending_payments', 'payment', 400, '/payment/pending_payments','', 'pending_payments','');
INSERT INTO %dbprefix%navigation_menu (menu_name, parent_name, menu_order, menu_url, menu_icon, menu_text, required_module, is_deleted, sync_status) VALUES ('patient_report', 'reports', '90', 'patient/patient_report', NULL, 'Patient Report ', NULL, NULL, NULL);
INSERT INTO %dbprefix%navigation_menu (menu_name, parent_name, menu_order, menu_url, menu_icon, menu_text, required_module) VALUES ('issue_refund', 'payment', '300', 'payment/issue_refund', NULL, 'issue_refund', NULL);
INSERT INTO %dbprefix%navigation_menu ( menu_name, parent_name, menu_order, menu_url, menu_icon, menu_text) VALUES ( 'bill', 'payment', '100', 'bill/index', NULL, 'bills');
INSERT INTO %dbprefix%navigation_menu ( menu_name, parent_name, menu_order, menu_url, menu_icon, menu_text) VALUES ( 'payments', 'payment', '200', 'payment/index', NULL, 'payments');
INSERT INTO %dbprefix%navigation_menu (menu_name, parent_name, menu_order, menu_url, menu_icon, menu_text) VALUES ('payment_methods', 'administration', '650', 'payment/payment_methods', NULL, 'payment_methods');
INSERT INTO %dbprefix%navigation_menu (menu_name, parent_name, menu_order, menu_url, menu_icon, menu_text) VALUES ( 'tax_rates', 'administration', '700', 'settings/tax_rates', NULL, 'tax_rates');
INSERT INTO %dbprefix%navigation_menu (menu_name, parent_name, menu_order, menu_url, menu_icon, menu_text, required_module, is_deleted, sync_status) VALUES ('tax_report', 'reports', '600', 'bill/tax_report', NULL, 'tax_report', NULL, NULL, NULL);
ALTER TABLE %dbprefix%receipt_template ADD is_original INT(1) NULL ;
CREATE OR REPLACE VIEW %dbprefix%view_contact_email AS SELECT contact_id,detail email FROM %dbprefix%contact_details WHERE type = 'email';
CREATE OR REPLACE VIEW %dbprefix%view_email AS SELECT contact_id,group_concat(detail) AS emails FROM %dbprefix%contact_details WHERE type = 'email' GROUP BY contact_id;
CREATE OR REPLACE VIEW %dbprefix%view_visit_treatments AS SELECT visit.visit_id,bill_detail.particular,bill_detail.type FROM %dbprefix%visit AS visit LEFT JOIN %dbprefix%bill AS bill ON bill.visit_id = visit.visit_id LEFT JOIN %dbprefix%bill_detail AS bill_detail ON bill_detail.bill_id = bill.bill_id;		
CREATE OR REPLACE VIEW %dbprefix%view_doctor  AS  select concat(ifnull(contacts.title,''),' ',ifnull(contacts.first_name,''),' ',ifnull(contacts.middle_name,''),' ',ifnull(contacts.last_name,'')) AS name,users.centers AS centers,contacts.title AS title,contacts.first_name AS first_name,contacts.middle_name AS middle_name,contacts.last_name AS last_name,doctor.doctor_id AS doctor_id,doctor.userid AS userid,doctor.degree AS degree,doctor.specification AS specification,doctor.experience AS experience,doctor.joining_date AS joining_date,doctor.licence_number AS licence_number,doctor.department_id AS department_id,doctor.gender AS gender,doctor.description AS description,doctor.dob AS dob,doctor.contact_id AS contact_id from ((%dbprefix%doctor doctor join %dbprefix%contacts contacts on((contacts.contact_id = doctor.contact_id))) join %dbprefix%users users on((users.userid = doctor.userid))) ;
INSERT INTO %dbprefix%clinic (clinic_id,start_time,end_time,time_interval,clinic_name,tag_line,clinic_address,landline,mobile,email,facebook,twitter, google_plus,next_followup_days,max_patient) VALUES ('1', '09:00', '18:00', '0.50', 'Chikitsa', 'Patient Management Software', NULL, NULL, NULL, NULL, NULL, NULL, NULL, '15',1);
INSERT INTO %dbprefix%contact_details (contact_id,type,detail) SELECT contact_id,'mobile',phone_number FROM %dbprefix%contacts WHERE (phone_number IS NOT NULL AND phone_number != '') AND contact_id IN (SELECT contact_id FROM %dbprefix%patient);
INSERT INTO %dbprefix%contact_details (contact_id,type,detail) SELECT contact_id,'mobile',second_number FROM %dbprefix%contacts WHERE (second_number IS NOT NULL AND second_number != '') AND contact_id IN (SELECT contact_id FROM %dbprefix%patient);
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) SELECT navigation_menu.menu_name,'System Administrator', '1' FROM %dbprefix%navigation_menu AS navigation_menu WHERE navigation_menu.menu_name NOT IN (SELECT menu_name FROM %dbprefix%menu_access WHERE category_name = 'System Administrator');
INSERT INTO %dbprefix%data (ck_key, ck_value) VALUES ('default_language', 'english');
INSERT INTO %dbprefix%data (ck_key, ck_value) VALUES ('default_timezone', 'UTC');
INSERT INTO %dbprefix%data (ck_key, ck_value) VALUES ('default_timeformate', 'h:i A');
INSERT INTO %dbprefix%data (ck_key, ck_value) VALUES ('default_dateformate', 'd-m-Y');
INSERT INTO %dbprefix%data (ck_key, ck_value) VALUES ( 'working_days', '7,1,2,3,4,5,6');
INSERT INTO %dbprefix%data (ck_key, ck_value) VALUES ( 'software_name', 'Chikitsa');
INSERT INTO %dbprefix%data (ck_key, ck_value) VALUES ( 'copyright_text', '&copy; 2020 Sanskruti Technologies');
INSERT INTO %dbprefix%data (ck_key, ck_value) VALUES ( 'copyright_url', 'http://sanskruti.net/ ');
INSERT INTO %dbprefix%data (ck_key, ck_value) VALUES ( 'website_text', 'Chikitsa');
INSERT INTO %dbprefix%data (ck_key, ck_value) VALUES ( 'website_url', 'http://chikitsa.sanskruti.net/ ');
INSERT INTO %dbprefix%data (ck_key, ck_value) VALUES ( 'support_text', 'Support Forum');
INSERT INTO %dbprefix%data (ck_key, ck_value) VALUES ( 'support_url', 'http://sanskruti.net/chikitsa/bug-tracker/');
INSERT INTO %dbprefix%data (ck_key, ck_value) VALUES ( 'support_url', '<h4>Chikitsa would not have been possible without the amazing works listed below</h4><h5><b>Framework</b></h5><a href="http://codeigniter.com">CodeIgniter 3.0.0</a><h5><b></b></h5><a href="https://bitbucket.org/wiredesignz/codeigniter-modular-extensions-hmvc">Modular Extensions - HMVC<h5><b></b></h5></a><h5><b>Theme</b></h5><a href="http://www.bootstrapzero.com/bootstrap-template/binary">Binary Admin (Bootstrap v3.1.1)</a><h5><b></b></h5><a href="https://fortawesome.github.io/Font-Awesome/">Font Awsome </a><h5><b></b></h5><a href="https://plugins.jquery.com/chosen/">Chosen</a><br><a href="http://lokeshdhakar.com/projects/lightbox2/">Lightbox </a><br><a href="http://xdsoft.net/jqplugins/datetimepicker/">DateTime Picker </a><br><a href="http://intridea.github.io/sketch.js/">Sketch</a><br><a href="https://www.tinymce.com/">TinyMCE</a><br>');
INSERT INTO %dbprefix%data (ck_key, ck_value) VALUES ( 'about_us_content', '<h4>Chikitsa would not have been possible without the amazing works listed below</h4><h5><b>Framework</b></h5><a href="http://codeigniter.com">CodeIgniter 3.0.0</a><h5><b></b></h5><a href="https://bitbucket.org/wiredesignz/codeigniter-modular-extensions-hmvc">Modular Extensions - HMVC<h5><b></b></h5></a><h5><b>Theme</b></h5><a href="http://www.bootstrapzero.com/bootstrap-template/binary">Binary Admin (Bootstrap v3.1.1)</a><h5><b></b></h5><a href="https://fortawesome.github.io/Font-Awesome/">Font Awsome </a><h5><b></b></h5><a href="https://plugins.jquery.com/chosen/">Chosen</a><br><a href="http://lokeshdhakar.com/projects/lightbox2/">Lightbox </a><br><a href="http://xdsoft.net/jqplugins/datetimepicker/">DateTime Picker </a><br><a href="http://intridea.github.io/sketch.js/">Sketch</a><br><a href="https://www.tinymce.com/">TinyMCE</a><br>');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) SELECT navigation_menu.menu_name,'Administrator', '1' FROM %dbprefix%navigation_menu AS navigation_menu WHERE navigation_menu.menu_name NOT IN (SELECT menu_name FROM %dbprefix%menu_access WHERE category_name = 'Administrator') AND navigation_menu.menu_name NOT IN ('rebrand')  LOCK IN SHARE MODE ;
INSERT INTO %dbprefix%invoice (invoice_id,static_prefix,left_pad,next_id,currency_symbol,currency_postfix) VALUES (1, '', '3', 1, 'Rs.', '');
INSERT INTO %dbprefix%receipt_template (template_id,template,is_default,template_name,type,is_original) VALUES (1, '<h1 style="text-align: center;">[clinic_name]</h1><h2 style="text-align: center;">[tag_line]</h2><p style="text-align: center;">[clinic_address]</p><p style="text-align: center;"><strong style="line-height: 1.42857143;">Landline : </strong><span style="line-height: 1.42857143;">[landline]</span> <strong style="line-height: 1.42857143;">Mobile : </strong><span style="line-height: 1.42857143;">[mobile]</span> <strong style="line-height: 1.42857143;">Email : </strong><span style="text-align: center;"> [email]</span></p><hr id="null" /><h3 style="text-align: center;"><u style="text-align: center;">RECEIPT</u></h3><p><span style="text-align: left;"><strong>Date : </strong>[bill_date] [bill_time]</span><span style="float: right;"><strong>Receipt Number :</strong> [bill_id]</span></p><p style="text-align: left;"><strong style="text-align: left;">Patient Name: </strong><span style="text-align: left;">[patient_name]<br /></span></p><hr id="null" style="text-align: left;" /><p>Received fees for Professional services and other charges of our:</p><p>&nbsp;</p><p>&nbsp;</p><table style="width: 100%; margin-top: 25px; margin-bottom: 25px; border-collapse: collapse; border: 1px solid black;"><thead><tr><td style="width: 400px; text-align: left; padding: 5px; border: 1px solid black;"><strong style="width: 400px; text-align: left;">Item</strong></td><td style="padding: 5px; border: 1px solid black;"><strong>Quantity</strong></td><td style="width: 100px; text-align: right; padding: 5px; border: 1px solid black;"><strong>M.R.P.</strong></td><td style="width: 100px; text-align: right; padding: 5px; border: 1px solid black;"><strong>Amount</strong></td></tr></thead><tbody><tr><td colspan="4">[col:particular|quantity|mrp|amount]</td></tr><tr><td style="padding: 5px; border: 1px solid black;" colspan="3">Discount</td><td style="text-align: right; padding: 5px; border: 1px solid black;"><strong>[discount]</strong></td></tr><tr><td>[tax_details]</td></tr><tr><td style="padding: 5px; border: 1px solid black;" colspan="3">Total</td><td style="text-align: right; padding: 5px; border: 1px solid black;"><strong>[total]</strong></td></tr><tr><td style="padding: 5px; border: 1px solid black;" colspan="3">Paid Amount</td><td style="text-align: right; padding: 5px; border: 1px solid black;">[paid_amount]</td></tr></tbody></table><p>Received with Thanks,</p><p>For [clinic_name]</p><p>&nbsp;</p><p>&nbsp;</p><p>Signature</p>', 1, 'Main','bill',1);
INSERT INTO %dbprefix%user_categories (category_name) VALUES ('System Administrator');
INSERT INTO %dbprefix%user_categories (category_name) VALUES ('Administrator');
INSERT INTO %dbprefix%user_categories (category_name) VALUES ('Doctor');
INSERT INTO %dbprefix%user_categories (category_name) VALUES ('Nurse');
INSERT INTO %dbprefix%user_categories (category_name) VALUES ('Receptionist');
INSERT INTO %dbprefix%version (current_version) VALUES ('0.7.7');
ALTER TABLE %dbprefix%appointments ADD clinic_code VARCHAR(6) NULL DEFAULT NULL;
CREATE OR REPLACE VIEW %dbprefix%view_patient AS SELECT patient.patient_id AS patient_id,patient.clinic_id AS clinic_id,patient.blood_group AS blood_group,patient.clinic_code AS clinic_code,patient.patient_since AS patient_since,patient.age AS age,patient.display_id AS display_id,patient.gender AS gender,patient.dob AS dob,patient.reference_by AS reference_by,patient.reference_by_detail AS reference_by_detail,patient.followup_date AS followup_date,((select ifnull(sum(ifnull(patient_account.adjust_amount,0)),0) from %dbprefix%patient_account patient_account where ((patient_account.patient_id = patient.patient_id) and (patient_account.payment_id is not null))) - (select ifnull(sum(ifnull(patient_account.adjust_amount,0)),0) from %dbprefix%patient_account patient_account where ((patient_account.patient_id = patient.patient_id) and (patient_account.bill_id is not null)))) AS in_account_amount,contacts.display_name AS display_name,contacts.contact_id AS contact_id,contacts.first_name AS first_name,contacts.middle_name AS middle_name,contacts.last_name AS last_name,(select contact_details.detail from %dbprefix%contact_details contact_details where ((contact_details.contact_id = contacts.contact_id) and (contact_details.type = 'mobile')) limit 1) AS phone_number,contacts.email AS email from (%dbprefix%patient patient left join %dbprefix%contacts contacts on((patient.contact_id = contacts.contact_id))) ;
INSERT INTO %dbprefix%data (ck_key, ck_value) VALUES ('login_page', 'appointment/index');
ALTER TABLE %dbprefix%bill CHANGE visit_id visit_id INT(11) NULL;
CREATE OR REPLACE VIEW %dbprefix%view_doctor AS SELECT doctor.contact_id,concat(ifnull(contacts.first_name,''),' ',ifnull(contacts.middle_name,''),' ',ifnull(contacts.last_name,'')) AS name,doctor.doctor_id AS doctor_id,doctor.userid AS userid,users.centers AS centers from %dbprefix%doctor doctor      join %dbprefix%contacts contacts on contacts.contact_id = doctor.contact_id	 join %dbprefix%users users on users.userid = doctor.userid;
UPDATE %dbprefix%patient SET clinic_id = 1;
UPDATE %dbprefix%bill SET clinic_id = 1;
UPDATE %dbprefix%payment SET clinic_id = 1;
UPDATE %dbprefix%clinic SET time_interval = time_interval * 60;
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('patient_report','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('appointment_report','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('appointment_report','System Administrator', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('bill_report','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('bill_report','System Administrator', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('tax_report','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('new_patient','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('payment','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('payment','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('payments','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('bill','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('issue_refund','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('appointment report','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('reports','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('appointments','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('new_inquiry','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('all_patients','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('patients','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('bill report','Doctor', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('pending_payments','Doctor', '1');
ALTER TABLE %dbprefix%contacts CHANGE first_name first_name VARCHAR(50) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL;
ALTER TABLE %dbprefix%contacts CHANGE middle_name middle_name VARCHAR(50) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL;
ALTER TABLE %dbprefix%contacts CHANGE last_name last_name VARCHAR(50) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL;
ALTER TABLE %dbprefix%contacts ADD area VARCHAR(25) NOT NULL AFTER  address_line_2;
ALTER TABLE %dbprefix%appointment_log ADD clinic_code VARCHAR(6) NULL AFTER sync_status;
ALTER TABLE %dbprefix%payment ADD clinic_code VARCHAR(6) NULL AFTER sync_status;
CREATE OR REPLACE VIEW %dbprefix%view_report AS SELECT appointment.appointment_id, 		       appointment.patient_id, 			   CONCAT(IFNULL(view_patient.first_name,''),' ',IFNULL(view_patient.middle_name,''), ' ',IFNULL(view_patient.last_name,'')) as patient_name,	   appointment.doctor_id,	   appointment.clinic_id,	   clinic.clinic_name,	   CONCAT(IFNULL(contacts.first_name,''),' ',IFNULL(contacts.middle_name,''), ' ',IFNULL(contacts.last_name,'')) as doctor_name,	   appointment.appointment_date,	   min(appointment.start_time) as appointment_time,	   max(CASE appointment_log.status WHEN 'Waiting' THEN appointment_log.from_time END) as waiting_in,	   (max(CASE appointment_log.status WHEN 'Consultation' THEN appointment_log.from_time END) - max(CASE appointment_log.status WHEN 'Waiting' THEN appointment_log.from_time END)) as waiting_duration,	   max(CASE appointment_log.status WHEN 'Consultation' THEN appointment_log.from_time END) as consultation_in,	   max(CASE appointment_log.status WHEN 'Complete' THEN appointment_log.from_time END) as consultation_out,	   (max(CASE appointment_log.status WHEN 'Complete' THEN appointment_log.from_time END) - max(CASE appointment_log.status WHEN 'Consultation' THEN appointment_log.from_time END)) as consultation_duration,	   max(CASE appointment_log.old_status WHEN 'Consultation' THEN timediff(appointment_log.to_time,appointment_log.from_time) END) as waiting_out,   max(bill.total_amount) as collection_amount	   FROM  %dbprefix%appointments as appointment	   LEFT JOIN %dbprefix%view_patient as view_patient ON appointment.patient_id = view_patient.patient_id	   LEFT JOIN %dbprefix%bill as bill ON appointment.visit_id = bill.visit_id 	   LEFT JOIN %dbprefix%appointment_log as appointment_log ON appointment.appointment_id = appointment_log.appointment_id	   LEFT JOIN %dbprefix%doctor AS doctor ON doctor.doctor_id = appointment.doctor_id	   LEFT JOIN %dbprefix%contacts AS contacts ON contacts.contact_id = doctor.contact_id	   LEFT JOIN %dbprefix%clinic AS clinic ON clinic.clinic_id = appointment.clinic_id	   GROUP BY appointment.appointment_id,patient_name;
CREATE OR REPLACE VIEW %dbprefix%view_bill_payment_r AS SELECT payment.pay_date,       bill_payment_r.bill_id,	   bill_payment_r.adjust_amount,	   payment.payment_id  FROM %dbprefix%payment AS payment       JOIN %dbprefix%bill_payment_r AS bill_payment_r ON bill_payment_r.payment_id = payment.payment_id;	   
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('patient_report','Nurse', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('appointment_report','Nurse', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('bill_report', 'Nurse', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('tax_report', 'Nurse', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('new_patient', 'Nurse', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('payment',  'Nurse', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('payments',  'Nurse', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('bill',  'Nurse', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('issue_refund', 'Nurse', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('patients', 'Nurse', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('all_patients','Nurse', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('new_inquiry', 'Nurse', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('appointments', 'Nurse', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('appointment report', 'Nurse', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('reports', 'Nurse', '1');
ALTER TABLE %dbprefix%contacts ADD clinic_code VARCHAR(6) NULL AFTER sync_status;
ALTER TABLE %dbprefix%bill_payment_r ADD clinic_code VARCHAR(6) NULL AFTER sync_status;
CREATE TABLE %dbprefix%tax_rates (  tax_id int(11) NOT NULL AUTO_INCREMENT,  tax_rate_name varchar(25) NOT NULL,  tax_rate decimal(10,2) NOT NULL, PRIMARY KEY (tax_id)) ;
CREATE OR REPLACE VIEW %dbprefix%view_report AS SELECT appointment.appointment_id AS appointment_id,appointment.patient_id AS patient_id,appointment.clinic_code AS clinic_code,CONCAT(IFNULL(view_patient.first_name,''),' ',IFNULL(view_patient.middle_name,''),' ',IFNULL(view_patient.last_name,'')) AS patient_name,appointment.doctor_id AS doctor_id,appointment.clinic_id AS clinic_id,appointment.status AS status,clinic.clinic_name AS clinic_name,CONCAT(IFNULL(contacts.first_name,''),' ',IFNULL(contacts.middle_name,''),' ',IFNULL(contacts.last_name,'')) AS doctor_name,appointment.appointment_date AS appointment_date,MIN(appointment.start_time) AS appointment_time,MAX((CASE appointment_log.status WHEN 'Waiting' THEN appointment_log.from_time END)) AS waiting_in,(MAX((CASE appointment_log.status WHEN 'Consultation' THEN appointment_log.from_time END)) - MAX((CASE appointment_log.status WHEN 'Waiting' THEN appointment_log.from_time END))) AS waiting_duration,MAX((CASE appointment_log.status WHEN 'Consultation' THEN appointment_log.from_time END)) AS consultation_in,MAX((CASE appointment_log.status WHEN 'Complete' THEN appointment_log.from_time END)) AS consultation_out,(MAX((CASE appointment_log.status WHEN 'Complete' THEN appointment_log.from_time END)) - MAX((CASE appointment_log.status WHEN 'Consultation' THEN appointment_log.from_time END))) AS consultation_duration,MAX((CASE appointment_log.old_status WHEN 'Consultation' THEN timediff(appointment_log.to_time,appointment_log.from_time) END)) AS waiting_out,MAX(bill.total_amount) AS collection_amount FROM %dbprefix%appointments appointment LEFT JOIN %dbprefix%view_patient view_patient  ON appointment.patient_id = view_patient.patient_id LEFT JOIN %dbprefix%bill bill ON appointment.visit_id = bill.visit_id LEFT JOIN %dbprefix%appointment_log appointment_log ON appointment.appointment_id = appointment_log.appointment_id LEFT JOIN %dbprefix%doctor doctor ON doctor.doctor_id = appointment.doctor_id LEFT JOIN %dbprefix%contacts contacts ON contacts.contact_id = doctor.contact_id LEFT JOIN %dbprefix%clinic clinic ON clinic.clinic_id = appointment.clinic_id GROUP BY appointment.appointment_id,CONCAT(IFNULL(view_patient.first_name,''),' ',IFNULL(view_patient.middle_name,''),' ',IFNULL(view_patient.last_name,'')) ;
ALTER TABLE %dbprefix%visit ADD clinic_code VARCHAR(6) NULL AFTER sync_status;
CREATE OR REPLACE VIEW %dbprefix%view_bill_detail_report  AS SELECT bill.bill_id AS bill_id,bill.bill_date AS bill_date,bill.visit_id AS visit_id,bill_detail.particular AS particular,bill_detail.amount AS amount,bill_detail.tax_amount AS tax_amount,visit.userid AS userid,CONCAT(view_patient.first_name,' ',view_patient.middle_name,' ',view_patient.last_name) AS patient_name,view_patient.display_id AS display_id,bill_detail.type AS type FROM %dbprefix%bill bill LEFT JOIN %dbprefix%bill_detail bill_detail ON bill_detail.bill_id = bill.bill_id LEFT JOIN %dbprefix%visit visit ON visit.visit_id = bill.visit_id LEFT JOIN %dbprefix%view_patient view_patient ON view_patient.patient_id = bill.patient_id WHERE IFNULL(bill_detail.is_deleted,0) <> 1;
ALTER TABLE %dbprefix%bill CHANGE total_amount total_amount DECIMAL(10,2) NOT NULL DEFAULT '0';
INSERT INTO %dbprefix%data (ck_key, ck_value) VALUE ('tax_type','bill'); 
INSERT INTO %dbprefix%tax_rates (tax_id, tax_rate_name, tax_rate) VALUES (1, 'No Tax', '0.00');
CREATE OR REPLACE VIEW %dbprefix%view_bill_tax_report AS select patient.display_id AS display_id, patient.first_name AS first_name,patient.middle_name AS middle_name,patient.last_name AS last_name,bill.bill_id AS bill_id,bill.bill_date AS bill_date,bill.total_amount AS total_amount,SUM(bill_detail.amount) AS tax_amount from %dbprefix%bill bill  join %dbprefix%view_patient patient on patient.patient_id = bill.patient_id left join %dbprefix%bill_detail bill_detail on bill_detail.bill_id = bill.bill_id AND bill_detail.type='tax' group by bill.bill_id;
UPDATE %dbprefix%receipt_template SET is_default = 0 WHERE type='bill';
INSERT INTO %dbprefix%receipt_template (template,is_default,template_name,type,is_original) VALUES ('<h1 style="text-align: center;">[clinic_name]</h1><h2 style="text-align: center;">[tag_line]</h2><p style="text-align: center;">[clinic_address]</p><p style="text-align: center;"><strong style="line-height: 1.42857143;">Landline : </strong><span style="line-height: 1.42857143;">[landline]</span> <strong style="line-height: 1.42857143;">Mobile : </strong><span style="line-height: 1.42857143;">[mobile]</span> <strong style="line-height: 1.42857143;">Email : </strong><span style="text-align: center;"> [email]</span></p><hr id="null" /><h3 style="text-align: center;"><u style="text-align: center;">RECEIPT</u></h3><p><span style="text-align: left;"><strong>Date : </strong>[bill_date] [bill_time]</span><span style="float: right;"><strong>Receipt Number :</strong> [bill_id]</span></p><p style="text-align: left;"><strong style="text-align: left;">Patient Name: </strong><span style="text-align: left;">[patient_name]<br /></span></p><hr id="null" style="text-align: left;" /><p>Received fees for Professional services and other charges of our:</p><p>&nbsp;</p><p>&nbsp;</p><table style="width: 100%; margin-top: 25px; margin-bottom: 25px; border-collapse: collapse; border: 1px solid black;"><thead><tr><td style="width: 400px; text-align: left; padding: 5px; border: 1px solid black;"><strong style="width: 400px; text-align: left;">Item</strong></td><td style="padding: 5px; border: 1px solid black;"><strong>Quantity</strong></td><td style="width: 100px; text-align: right; padding: 5px; border: 1px solid black;"><strong>M.R.P.</strong></td><td style="width: 100px; text-align: right; padding: 5px; border: 1px solid black;"><strong>Amount</strong></td>[tax_column_header]</tr></thead><tbody><tr><td colspan="4">[col:particular|quantity|mrp|amount|tax_amount]</td></tr><tr><td style="padding: 5px; border: 1px solid black;" colspan="3">Discount</td><td style="text-align: right; padding: 5px; border: 1px solid black;"><strong>[discount]</strong></td></tr><tr><td>[tax_details]</td></tr><tr><td style="padding: 5px; border: 1px solid black;" colspan="3">Total</td><td style="text-align: right; padding: 5px; border: 1px solid black;"><strong>[total]</strong></td></tr><tr><td style="padding: 5px; border: 1px solid black;" colspan="3">Paid Amount</td><td style="text-align: right; padding: 5px; border: 1px solid black;">[paid_amount]</td></tr></tbody></table><p>Received with Thanks,</p><p>For [clinic_name]</p><p>&nbsp;</p><p>&nbsp;</p><p>Signature</p>', 1, 'Main with Tax','bill',1);
UPDATE %dbprefix%receipt_template SET template = '<h1 style="text-align: center;">[clinic_name]</h1><h2 style="text-align: center;">[tag_line]</h2><p style="text-align: center;">[clinic_address]</p><p style="text-align: center;"><strong style="line-height: 1.42857143;">Landline : </strong><span style="line-height: 1.42857143;">[landline]</span> <strong style="line-height: 1.42857143;">Mobile : </strong><span style="line-height: 1.42857143;">[mobile]</span> <strong style="line-height: 1.42857143;">Email : </strong><span style="text-align: center;"> [email]</span></p><hr id="null" /><h3 style="text-align: center;"><u style="text-align: center;">RECEIPT</u></h3><p><span style="text-align: left;"><strong>Date : </strong>[bill_date] [bill_time]</span><span style="float: right;"><strong>Receipt Number :</strong> [bill_id]</span></p><p style="text-align: left;"><strong style="text-align: left;">Patient Name: </strong><span style="text-align: left;">[patient_name]<br /></span></p><hr id="null" style="text-align: left;" /><p>Received fees for Professional services and other charges of our:</p><p>&nbsp;</p><p>&nbsp;</p><table style="width: 100%; margin-top: 25px; margin-bottom: 25px; border-collapse: collapse; border: 1px solid black;"><thead><tr><td style="width: 400px; text-align: left; padding: 5px; border: 1px solid black;"><strong style="width: 400px; text-align: left;">Item</strong></td><td style="padding: 5px; border: 1px solid black;"><strong>Quantity</strong></td><td style="width: 100px; text-align: right; padding: 5px; border: 1px solid black;"><strong>M.R.P.</strong></td><td style="width: 100px; text-align: right; padding: 5px; border: 1px solid black;"><strong>Amount</strong></td>[tax_column_header]</tr></thead><tbody><tr><td colspan="4">[col:particular|quantity|mrp|amount|tax_amount]</td></tr><tr><td style="padding: 5px; border: 1px solid black;" colspan="3">Discount</td><td style="text-align: right; padding: 5px; border: 1px solid black;"><strong>[discount]</strong></td></tr><tr><td>[tax_details]</td></tr><tr><td style="padding: 5px; border: 1px solid black;" colspan="3">Total</td><td style="text-align: right; padding: 5px; border: 1px solid black;"><strong>[total]</strong></td></tr><tr><td style="padding: 5px; border: 1px solid black;" colspan="3">Paid Amount</td><td style="text-align: right; padding: 5px; border: 1px solid black;">[paid_amount]</td></tr></tbody></table><p>Received with Thanks,</p><p>For [clinic_name]</p><p>&nbsp;</p><p>&nbsp;</p><p>Signature</p>' WHERE type='bill' AND template_name = 'Main with Tax';
CREATE OR REPLACE VIEW %dbprefix%view_tax_report AS select patient.display_id AS display_id,patient.first_name AS first_name,patient.middle_name AS middle_name,patient.last_name AS last_name,bill.bill_id AS bill_id,bill.bill_date AS bill_date,(SELECT IFNULL(SUM(IFNULL(bill_detail_tax.amount,0)),0) FROM %dbprefix%bill_detail AS bill_detail_tax WHERE bill_detail_tax.bill_id = bill.bill_id AND ifnull(bill_detail_tax.tax_amount,0) > 0)  AS taxable_amount,(SELECT IFNULL(SUM(IFNULL(bill_detail_item_tax.tax_amount,0)),0) FROM %dbprefix%bill_detail AS bill_detail_item_tax WHERE bill_detail_item_tax.bill_id = bill.bill_id )  AS item_tax_amount,(SELECT IFNULL(SUM(IFNULL(bill_detail_nontax.amount,0)),0) FROM %dbprefix%bill_detail AS bill_detail_nontax WHERE bill_detail_nontax.bill_id = bill.bill_id AND ifnull(bill_detail_nontax.tax_amount,0) = 0)  AS non_taxable_amount,bill.tax_amount AS bill_tax_amount,bill.total_amount AS total_amount from %dbprefix%bill bill join %dbprefix%view_patient patient on patient.patient_id = bill.patient_id;
ALTER TABLE %dbprefix%receipt_template CHANGE template template TEXT CHARACTER SET utf8 COLLATE utf8_bin NOT NULL;
ALTER TABLE %dbprefix%clinic CHANGE clinic_name clinic_name VARCHAR(50) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL;
ALTER TABLE %dbprefix%clinic CHANGE tag_line tag_line VARCHAR(100) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL;
ALTER TABLE %dbprefix%bill_detail CHANGE particular particular VARCHAR(50) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL;
CREATE OR REPLACE VIEW %dbprefix%view_tax_report AS select patient.display_id AS display_id,patient.first_name AS first_name,patient.middle_name AS middle_name,patient.last_name AS last_name,bill.bill_id AS bill_id,bill.bill_date AS bill_date,(SELECT SUM(IFNULL(bill_detail_tax.amount,0)) FROM %dbprefix%bill_detail bill_detail_tax WHERE bill_detail_tax.bill_id = bill.bill_id and ifnull(bill_detail_tax.tax_amount,0) > 0) AS taxable_amount,(SELECT SUM(IFNULL(bill_detail_non.amount,0)) FROM %dbprefix%bill_detail bill_detail_non WHERE bill_detail_non.bill_id = bill.bill_id and ifnull(bill_detail_non.tax_amount,0) = 0 and bill_detail_non.type != 'discount') AS non_taxable_amount,(SELECT SUM(IFNULL(bill_detail_discount.amount,0)) FROM %dbprefix%bill_detail bill_detail_discount WHERE bill_detail_discount.bill_id = bill.bill_id and bill_detail_discount.type = 'discount') AS discount,bill.tax_amount AS item_tax_amount,bill.total_amount AS total_amount from %dbprefix%bill bill  join %dbprefix%view_patient patient on patient.patient_id = bill.patient_id;
INSERT INTO %dbprefix%payment_methods (payment_method_name, has_additional_details, additional_detail_label, needs_cash_calc) VALUES ( 'Cash', 0, '', 1);
INSERT INTO %dbprefix%payment_methods (payment_method_name, has_additional_details, additional_detail_label, needs_cash_calc) VALUES ( 'Cheque', 1, 'Cheque Number', 0);
CREATE TABLE %dbprefix%refund ( refund_id int(11) NOT NULL, patient_id int(11) NOT NULL, refund_amount int(12) NOT NULL, refund_date date NOT NULL, refund_note varchar(25) NOT NULL);
ALTER TABLE %dbprefix%patient_account ADD refund_id INT(11) NULL;
CREATE OR REPLACE VIEW %dbprefix%view_bill  AS select bill.bill_id AS bill_id, bill.bill_date AS bill_date,	   bill.visit_id AS visit_id,	   doctor.name AS doctor_name,	   ifnull(visit.doctor_id,bill.doctor_id) AS doctor_id,	   visit.clinic_id AS clinic_id,	   clinic.clinic_name AS clinic_name,	   patient.patient_id AS patient_id,	   patient.display_id AS display_id,	   contacts.first_name AS first_name,	   contacts.middle_name AS middle_name,	   contacts.last_name AS last_name,	   bill.total_amount AS total_amount,	   ifnull(bill.tax_amount,0) AS item_tax_amount,	   sum(bill_detail.amount) AS bill_tax_amount,	   bill.due_amount AS due_amount,	   ((select sum(bill_payment_r.adjust_amount) from %dbprefix%bill_payment_r bill_payment_r where (bill_payment_r.bill_id = bill.bill_id))	   + (SELECT SUM(patient_account.adjust_amount) FROM %dbprefix%patient_account patient_account WHERE patient_account.bill_id = bill.bill_id)) AS pay_amount   from ((((((%dbprefix%bill bill left join %dbprefix%visit visit on((bill.visit_id = visit.visit_id))) left join %dbprefix%clinic clinic on((clinic.clinic_id = bill.clinic_id))) left join %dbprefix%patient patient on((bill.patient_id = patient.patient_id))) left join %dbprefix%contacts contacts on((contacts.contact_id = patient.contact_id))) left join %dbprefix%view_doctor doctor on((ifnull(visit.doctor_id,bill.doctor_id) = doctor.doctor_id))) left join %dbprefix%bill_detail bill_detail on(((bill_detail.bill_id = bill.bill_id) and (bill_detail.type = 'tax')))) group by bill.bill_id,doctor.name,visit.userid,patient.patient_id ;
CREATE OR REPLACE VIEW %dbprefix%view_doctor  AS  select concat(ifnull(contacts.title,''),' ',ifnull(contacts.first_name,''),' ',ifnull(contacts.middle_name,''),' ',ifnull(contacts.last_name,'')) AS name,users.centers AS centers,contacts.title AS title,contacts.first_name AS first_name,contacts.middle_name AS middle_name,contacts.last_name AS last_name,doctor.doctor_id AS doctor_id,doctor.userid AS userid,doctor.degree AS degree,doctor.specification AS specification,doctor.experience AS experience,doctor.joining_date AS joining_date,doctor.licence_number AS licence_number,doctor.department_id AS department_id,doctor.gender AS gender,doctor.description AS description,doctor.dob AS dob,doctor.contact_id AS contact_id from ((%dbprefix%doctor doctor join %dbprefix%contacts contacts on((contacts.contact_id = doctor.contact_id))) join %dbprefix%users users on((users.userid = doctor.userid))) ;
CREATE OR REPLACE VIEW %dbprefix%view_patient AS SELECT patient.ssn_id,patient.is_inquiry,patient.inquiry_reason,patient.sync_status,patient.is_deleted, patient.erpnext_key,patient.patient_id AS patient_id,patient.clinic_id AS clinic_id,patient.blood_group AS blood_group,patient.clinic_code AS clinic_code,patient.patient_since AS patient_since,patient.age AS age,patient.display_id AS display_id,patient.gender AS gender,patient.dob AS dob,patient.reference_by AS reference_by,patient.reference_by_detail AS reference_by_detail,patient.followup_date AS followup_date,((select ifnull(sum(ifnull(patient_account.adjust_amount,0)),0) from %dbprefix%patient_account patient_account where ((patient_account.patient_id = patient.patient_id) and (patient_account.payment_id is not null))) - (select ifnull(sum(ifnull(patient_account.adjust_amount,0)),0) from %dbprefix%patient_account patient_account where ((patient_account.patient_id = patient.patient_id) and (patient_account.bill_id is not null)))) AS in_account_amount,contacts.display_name AS display_name,contacts.contact_id AS contact_id,contacts.title AS title,contacts.first_name AS first_name,contacts.middle_name AS middle_name,contacts.last_name AS last_name,CONCAT(IFNULL(contacts.title,''),' ',IFNULL(contacts.first_name,''),' ',IFNULL(contacts.middle_name,''),' ',IFNULL(contacts.last_name,'')) AS patient_name,(select contact_details.detail from %dbprefix%contact_details contact_details where ((contact_details.contact_id = contacts.contact_id) and (contact_details.type = 'mobile')) limit 1) AS phone_number,contacts.email AS email from (%dbprefix%patient patient left join %dbprefix%contacts contacts on((patient.contact_id = contacts.contact_id))) ;
ALTER TABLE %dbprefix%bill ADD appointment_id INT(11) NULL;
ALTER TABLE %dbprefix%bill_detail ADD tax_id INT(11) NULL;
ALTER TABLE %dbprefix%payment_methods ADD payment_pending INT(1) NULL AFTER needs_cash_calc;
CREATE OR REPLACE VIEW %dbprefix%view_payment  AS  select distinct payment.payment_id AS payment_id,payment.clinic_id AS clinic_id,payment.pay_date AS pay_date,payment.pay_mode AS pay_mode,payment.payment_status,payment.additional_detail AS additional_detail,payment.pay_amount AS pay_amount,patient.patient_id AS patient_id,patient.display_id AS display_id,contacts.first_name AS first_name,contacts.middle_name AS middle_name,contacts.last_name AS last_name from ((%dbprefix%payment payment join %dbprefix%patient patient on((patient.patient_id = payment.patient_id))) join %dbprefix%contacts contacts on((contacts.contact_id = patient.contact_id))) ;
CREATE OR REPLACE VIEW %dbprefix%view_visit  AS  select visit.visit_id AS visit_id,visit.visit_date AS visit_date,visit.visit_time AS visit_time,visit.appointment_reason AS appointment_reason,visit.type AS type,visit.notes AS notes,visit.patient_notes AS patient_notes,visit.doctor_id AS doctor_id,doctor.name AS name,visit.patient_id AS patient_id,patient.reference_by AS reference_by,patient.reference_by_detail AS reference_by_detail,bill.bill_id AS bill_id,bill.total_amount AS total_amount,(select ifnull(sum(ifnull(bill_detail.amount,0)),0) from %dbprefix%bill_detail bill_detail where ((bill_detail.bill_id = bill.bill_id) and (bill_detail.type = 'tax'))) AS bill_tax_amount,(select sum(item_bill_detail.tax_amount) from %dbprefix%bill_detail item_bill_detail where (item_bill_detail.bill_id = bill.bill_id)) AS item_tax_amount,bill.due_amount AS due_amount from %dbprefix%visit visit join %dbprefix%view_doctor doctor on doctor.doctor_id = visit.doctor_id join %dbprefix%patient patient on patient.patient_id = visit.patient_id join %dbprefix%bill bill on bill.visit_id = visit.visit_id order by visit.patient_id,visit.visit_date,visit.visit_time ;
ALTER TABLE %dbprefix%language_data ADD UNIQUE( l_name, l_index);
CREATE TABLE %dbprefix%nurse ( nurse_id INT(11) NOT NULL AUTO_INCREMENT PRIMARY KEY , contact_id INT(11) NOT NULL , joining_date DATE NOT NULL , department_id VARCHAR(25) NOT NULL , userid VARCHAR(16) NOT NULL , is_deleted INT(11) NOT NULL , sync_status INT(11) NOT NULL , gender VARCHAR(10) NOT NULL );
UPDATE %dbprefix%navigation_menu SET menu_name = 'bill_report' WHERE menu_name = 'bill report';
UPDATE %dbprefix%navigation_menu SET menu_name = 'appointment_report' WHERE menu_name = 'appointment report';
UPDATE %dbprefix%navigation_menu SET menu_text = 'clinic_details' WHERE menu_name = 'clinic detail';
UPDATE %dbprefix%navigation_menu SET menu_text = 'patients' WHERE menu_name = 'patients';
UPDATE %dbprefix%navigation_menu SET menu_text = 'appointments' WHERE menu_name = 'appointments';
UPDATE %dbprefix%navigation_menu SET menu_text = 'reports' WHERE menu_name = 'reports';
UPDATE %dbprefix%navigation_menu SET menu_text = 'modules' WHERE menu_name = 'modules';
UPDATE %dbprefix%navigation_menu SET menu_text = 'administration' WHERE menu_name = 'administration';
UPDATE %dbprefix%navigation_menu SET menu_text = 'payments' WHERE menu_name = 'payment';
UPDATE %dbprefix%navigation_menu SET menu_text = 'frontend' WHERE menu_name = 'frontend';
UPDATE %dbprefix%navigation_menu SET menu_text = 'cases' WHERE menu_name = 'snaap_cases';
UPDATE %dbprefix%navigation_menu SET menu_text = 'cases' WHERE menu_name = 'cases';
UPDATE %dbprefix%navigation_menu SET menu_text = 'accounts' WHERE menu_name = 'account';
UPDATE %dbprefix%navigation_menu SET menu_text = 'account' WHERE menu_name = 'account';
UPDATE %dbprefix%navigation_menu SET menu_text = 'rooms_beds' WHERE menu_name = 'rooms';
UPDATE %dbprefix%navigation_menu SET menu_text = 'doctor' WHERE menu_name = 'doctor';
UPDATE %dbprefix%navigation_menu SET menu_text = 'treatments' WHERE menu_name = 'treatment';
UPDATE %dbprefix%navigation_menu SET menu_text = 'stock' WHERE menu_name = 'stock';
UPDATE %dbprefix%navigation_menu SET menu_text = 'cash_receipt' WHERE menu_name = 'cash_receipt';
UPDATE %dbprefix%navigation_menu SET menu_text = 'bank_payment' WHERE menu_name = 'bank_payment';
UPDATE %dbprefix%navigation_menu SET menu_text = 'account_group_master' WHERE menu_name = 'account_group_master';
UPDATE %dbprefix%navigation_menu SET menu_text = 'account_details_meta' WHERE menu_name = 'account_details_meta';
UPDATE %dbprefix%navigation_menu SET menu_text = 'accounts' WHERE menu_name = 'accounts';
UPDATE %dbprefix%navigation_menu SET menu_text = 'reference_by' WHERE menu_name = 'reference_by';
UPDATE %dbprefix%navigation_menu SET menu_text = 'backup' WHERE menu_name = 'backup';
UPDATE %dbprefix%navigation_menu SET menu_text = 'working_days' WHERE menu_name = 'working_days';
UPDATE %dbprefix%navigation_menu SET menu_text = 'clinic_detail' WHERE menu_name = 'center_details';
UPDATE %dbprefix%navigation_menu SET menu_text = 'all_users' WHERE menu_name = 'all_users';
UPDATE %dbprefix%navigation_menu SET menu_text = 'users' WHERE menu_name = 'users';
UPDATE %dbprefix%navigation_menu SET menu_text = 'add_patient' WHERE menu_name = 'new_patient';
UPDATE %dbprefix%navigation_menu SET menu_text = 'general_settings' WHERE menu_name = 'general_settings';
UPDATE %dbprefix%navigation_menu SET menu_text = 'all_patients' WHERE menu_name = 'all_patients';
UPDATE %dbprefix%navigation_menu SET menu_text = 'new_inquiry' WHERE menu_name = 'new_inquiry';
UPDATE %dbprefix%navigation_menu SET menu_text = 'clinic_details' WHERE menu_name = 'clinic_details';
UPDATE %dbprefix%navigation_menu SET menu_text = 'bill_report' WHERE menu_name = 'bill_report';
UPDATE %dbprefix%navigation_menu SET menu_text = 'appointment_report' WHERE menu_name = 'appointment_report';
UPDATE %dbprefix%navigation_menu SET menu_text = 'setting' WHERE menu_name = 'setting';
UPDATE %dbprefix%navigation_menu SET menu_text = 'services' WHERE menu_name = 'services';
UPDATE %dbprefix%navigation_menu SET menu_text = 'services_type' WHERE menu_name = 'service_type';
UPDATE %dbprefix%navigation_menu SET menu_text = 'services_type' WHERE menu_name = 'services_type';
UPDATE %dbprefix%navigation_menu SET menu_text = 'services' WHERE menu_name = 'all_services';
UPDATE %dbprefix%navigation_menu SET menu_text = 'patient_report' WHERE menu_name = 'patient_report';
UPDATE %dbprefix%navigation_menu SET menu_text = 'doctor_detail' WHERE menu_name = 'doctor_detail';
UPDATE %dbprefix%navigation_menu SET menu_text = 'department' WHERE menu_name = 'department';
UPDATE %dbprefix%navigation_menu SET menu_text = 'fees_detail' WHERE menu_name = 'fees_detail';
UPDATE %dbprefix%navigation_menu SET menu_text = 'doctor_schedule' WHERE menu_name = 'doctor_schedule';
UPDATE %dbprefix%navigation_menu SET menu_text = 'doctor_inavailability' WHERE menu_name = 'doctor_inavailability';
UPDATE %dbprefix%navigation_menu SET menu_text = 'doctor_preferences' WHERE menu_name = 'doctor_preferences';
UPDATE %dbprefix%navigation_menu SET menu_text = 'stock_item' WHERE menu_name = 'stock_item';
UPDATE %dbprefix%navigation_menu SET menu_text = 'stock_suppliers' WHERE menu_name = 'stock_suppliers';
UPDATE %dbprefix%navigation_menu SET menu_text = 'stock_purchase' WHERE menu_name = 'stock_purchase';
UPDATE %dbprefix%navigation_menu SET menu_text = 'stock_sell' WHERE menu_name = 'stock_sell';
UPDATE %dbprefix%navigation_menu SET menu_text = 'stock_all_sell' WHERE menu_name = 'stock_all_sell';
UPDATE %dbprefix%navigation_menu SET menu_text = 'stock_stock_report' WHERE menu_name = 'stock_stock_report';
UPDATE %dbprefix%navigation_menu SET menu_text = 'stock_purchase_report' WHERE menu_name = 'stock_purchase_report';
UPDATE %dbprefix%navigation_menu SET menu_text = 'stock_report' WHERE menu_name = 'stock_report';
UPDATE %dbprefix%navigation_menu SET menu_text = 'stock_sell_report' WHERE menu_name = 'stock_sell_report';
UPDATE %dbprefix%navigation_menu SET menu_text = 'purchase_return' WHERE menu_name = 'purchase_return';
UPDATE %dbprefix%navigation_menu SET menu_text = 'sell_return' WHERE menu_name = 'sell_return';
UPDATE %dbprefix%navigation_menu SET menu_text = 'opening_stock' WHERE menu_name = 'opening_stock';
UPDATE %dbprefix%navigation_menu SET menu_text = 'receipt_template' WHERE menu_name = 'receipt_template';
UPDATE %dbprefix%navigation_menu SET menu_text = 'alert_settings' WHERE menu_name = 'alert_settings';
UPDATE %dbprefix%navigation_menu SET menu_text = 'alert_sms_log' WHERE menu_name = 'alert_sms_log';
UPDATE %dbprefix%navigation_menu SET menu_text = 'alert_email_log' WHERE menu_name = 'alert_email_log';
UPDATE %dbprefix%navigation_menu SET menu_text = 'import' WHERE menu_name = 'import';
UPDATE %dbprefix%navigation_menu SET menu_text = 'category' WHERE menu_name = 'category';
UPDATE %dbprefix%navigation_menu SET menu_text = 'categories' WHERE menu_name = 'categories';
UPDATE %dbprefix%navigation_menu SET menu_text = 'menu_access' WHERE menu_name = 'menu_access';
UPDATE %dbprefix%navigation_menu SET menu_text = 'special_access' WHERE menu_name = 'special_access';
UPDATE %dbprefix%navigation_menu SET menu_text = 'medicine' WHERE menu_name = 'medicine';
UPDATE %dbprefix%navigation_menu SET menu_text = 'rebrand' WHERE menu_name = 'rebrand';
UPDATE %dbprefix%navigation_menu SET menu_text = 'treatment' WHERE menu_name = 'treatment';
UPDATE %dbprefix%navigation_menu SET menu_text = 'treatment_report' WHERE menu_name = 'treatment_report';
UPDATE %dbprefix%navigation_menu SET menu_text = 'doctor_bonus_report' WHERE menu_name = 'doctor_bonus_report';
UPDATE %dbprefix%navigation_menu SET menu_text = 'bills_payments', menu_url='#' WHERE menu_name = 'payment';
UPDATE %dbprefix%navigation_menu SET menu_text = 'bills_payments', menu_url='#' WHERE menu_name = 'payment';
UPDATE %dbprefix%navigation_menu SET menu_text = 'header_settings' WHERE menu_name = 'header_settings';
UPDATE %dbprefix%navigation_menu SET menu_text = 'home_settings' WHERE menu_name = 'home_settings';
UPDATE %dbprefix%navigation_menu SET menu_text = 'footer_settings' WHERE menu_name = 'footer_settings';
UPDATE %dbprefix%navigation_menu SET menu_text = 'news_setting' WHERE menu_name = 'news_setting';
UPDATE %dbprefix%navigation_menu SET menu_text = 'services_setting' WHERE menu_name = 'services_setting';
UPDATE %dbprefix%navigation_menu SET menu_text = 'images' WHERE menu_name = 'images';
UPDATE %dbprefix%navigation_menu SET menu_text = 'tax_rates' WHERE menu_name = 'tax_rates';
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('new_patient','Receptionist', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('payment','Receptionist', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('payments','Receptionist', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('bill','Receptionist', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('issue_refund','Receptionist', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('pending_payments','Receptionist', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('appointments','Receptionist', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('new_inquiry','Receptionist', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('all_patients','Receptionist', '1');
INSERT INTO %dbprefix%menu_access (menu_name, category_name, allow) VALUES ('patients','Receptionist', '1');
ALTER TABLE %dbprefix%language_data CHANGE l_value l_value VARCHAR(700) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL;
ALTER TABLE %dbprefix%contacts CHANGE contact_image contact_image VARCHAR(255) NOT NULL DEFAULT ''; 
ALTER TABLE %dbprefix%working_days ADD end_date DATE NULL ;
ALTER TABLE %dbprefix%working_days ADD start_time TIME NULL ;
ALTER TABLE %dbprefix%working_days ADD end_time TIME NULL ;
INSERT INTO %dbprefix%receipt_template (template,is_default,template_name,type,is_original) VALUES ('<h1 style="text-align: center;">[clinic_name]</h1><h2 style="text-align: center;">[tag_line]</h2><p style="text-align: center;">[clinic_address]</p><p style="text-align: center;"><strong style="line-height: 1.42857143;">Landline : </strong><span style="line-height: 1.42857143;">[landline]</span> <strong style="line-height: 1.42857143;">Mobile : </strong><span style="line-height: 1.42857143;">[mobile]</span> <strong style="line-height: 1.42857143;">Email : </strong><span style="text-align: center;"> [email]</span></p><hr id="null" /><h3 style="text-align: center;"><u style="text-align: center;">RECEIPT</u></h3><p><span style="text-align: left;"><strong>Date : </strong>[bill_date] [bill_time]</span><span style="float: right;"><strong>Receipt Number :</strong> [bill_id]</span></p><p style="text-align: left;"><strong style="text-align: left;">Patient Name: </strong><span style="text-align: left;">[patient_name]<br /></span></p><hr id="null" style="text-align: left;" /><p>Received fees for Professional services and other charges of our:</p><p>&nbsp;</p><p>&nbsp;</p><table style="width: 100%; margin-top: 25px; margin-bottom: 25px; border-collapse: collapse; border: 1px solid black;"><thead><tr><td style="width: 400px; text-align: left; padding: 5px; border: 1px solid black;"><strong style="width: 400px; text-align: left;">Item</strong></td><td style="padding: 5px; border: 1px solid black;"><strong>Quantity</strong></td><td style="width: 100px; text-align: right; padding: 5px; border: 1px solid black;"><strong>M.R.P.</strong></td><td style="width: 100px; text-align: right; padding: 5px; border: 1px solid black;"><strong>Amount</strong></td>[tax_column_header]</tr></thead><tbody><tr><td colspan="4">[col:particular|quantity|mrp|amount|tax_amount]</td></tr><tr><td style="padding: 5px; border: 1px solid black;" colspan="3">Discount</td><td style="text-align: right; padding: 5px; border: 1px solid black;"><strong>[discount]</strong></td></tr><tr><td>[tax_details]</td></tr><tr><td style="padding: 5px; border: 1px solid black;" colspan="3">Total</td><td style="text-align: right; padding: 5px; border: 1px solid black;"><strong>[total]</strong></td></tr><tr><td style="padding: 5px; border: 1px solid black;" colspan="3">Paid Amount</td><td style="text-align: right; padding: 5px; border: 1px solid black;">[paid_amount]</td></tr></tbody></table><p>Received with Thanks,</p><p>For [clinic_name]</p><p>&nbsp;</p><p>&nbsp;</p><p>Signature</p>', 1, 'Main with Tax','bill',1);
UPDATE %dbprefix%version SET current_version='0.8.4';
ALTER TABLE %dbprefix%modules ADD UNIQUE(module_name);
ALTER TABLE %dbprefix%data CHANGE ck_value ck_value TEXT NOT NULL DEFAULT ''; 
ALTER TABLE %dbprefix%data ADD UNIQUE(ck_key);
ALTER TABLE %dbprefix%modules ADD UNIQUE(module_name);
UPDATE %dbprefix%version SET current_version='0.8.5';
UPDATE %dbprefix%navigation_menu SET parent_name = 'administration' WHERE menu_name='pending_payments'; 
UPDATE %dbprefix%version SET current_version='0.8.8';
ALTER TABLE %dbprefix%users ADD prefered_language VARCHAR(25) NULL; 
UPDATE %dbprefix%version SET current_version='0.9.0';
DELETE t1 FROM %dbprefix%data t1 INNER JOIN %dbprefix%data t2 WHERE t1.ck_data_id < t2.ck_data_id AND t1.ck_key = t2.ck_key;
ALTER TABLE %dbprefix%data ADD UNIQUE(ck_key);
CREATE TABLE %dbprefix%language_master (language_id int(11) NOT NULL AUTO_INCREMENT,language_name varchar(25) NOT NULL,is_rtl int(1) NOT NULL,PRIMARY KEY (language_id));
ALTER TABLE %dbprefix%language_master ADD UNIQUE(language_name); 
ALTER TABLE %dbprefix%language_master ADD is_default INT(1) NOT NULL DEFAULT '0' AFTER is_rtl; 
INSERT INTO %dbprefix%language_master (language_name) SELECT distinct l_name FROM %dbprefix%language_data;
INSERT INTO %dbprefix%navigation_menu (id, menu_name, parent_name, menu_order,menu_url, menu_icon, menu_text, required_module, is_deleted, sync_status) VALUES (NULL, 'language', 'administration', '', 'settings/language', NULL, 'language', NULL, NULL, NULL);
CREATE OR REPLACE VIEW %dbprefix%view_bill AS 	SELECT bill.bill_id AS bill_id,      			bill.bill_date AS bill_date,      			doctor.name AS doctor_name,      			IFNULL(visit.doctor_id,bill.doctor_id) AS doctor_id,			patient.patient_id AS patient_id,			patient.display_id AS display_id,		contacts.first_name ASfirst_name,			contacts.middle_name AS middle_name,			contacts.last_name AS last_name,		bill.total_amount AS total_amount,			bill.tax_amount AS bill_tax_amount,			bill.due_amount AS due_amount,		(SELECT SUM(IFNULL(bill_detail.tax_amount,0)) FROM %dbprefix%bill_detail bill_detail WHERE bill_detail.bill_id = bill.bill_id) AS item_tax_amount,			SUM(IF(payment.payment_status != "rejected",bill_payment_r.adjust_amount,0)) AS pay_amount  	   FROM %dbprefix%bill AS bill      	        LEFT JOIN %dbprefix%patient patient ON bill.patient_id = patient.patient_id      			LEFT JOIN %dbprefix%contacts contacts on contacts.contact_id = patient.contact_id      			LEFT JOIN %dbprefix%visit visit ON bill.visit_id = visit.visit_id       			LEFT JOIN%dbprefix%bill_payment_r bill_payment_r ON bill.bill_id = bill_payment_r.bill_id      			LEFT JOIN %dbprefix%paymentpayment ON payment.payment_id = bill_payment_r.payment_id      			LEFT JOIN %dbprefix%view_doctor doctor ON IFNULL(visit.doctor_id,bill.doctor_id) = doctor.doctor_id 	  GROUP BY bill.bill_id ;
INSERT INTO %dbprefix%menu_access (id, menu_name, category_name, allow) VALUES (NULL, 'language', 'System Administrator', 1);
ALTER TABLE %dbprefix%patient CHANGE reference_by_detail reference_by_detail VARCHAR(50) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL;
ALTER TABLE %dbprefix%patient CHANGE reference_by reference_by VARCHAR(50) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL;
ALTER TABLE %dbprefix%patient CHANGE gender gender VARCHAR(50) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL;
ALTER TABLE %dbprefix%patient CHANGE inquiry_reason inquiry_reason VARCHAR(50) CHARACTER SET utf8 COLLATE utf8_bin NULL DEFAULT NULL;
UPDATE %dbprefix%version SET current_version='0.9.1';
